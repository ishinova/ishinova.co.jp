# アーキテクチャドキュメント

## 目次

1. [技術スタック](#技術スタック)
2. [プロジェクト構造](#プロジェクト構造)
3. [コンポーネントアーキテクチャ](#コンポーネントアーキテクチャ)
4. [データフロー](#データフロー)
5. [ビルドプロセス](#ビルドプロセス)
6. [技術選定の理由](#技術選定の理由)

## 技術スタック

### コアテクノロジー

| 技術 | バージョン | 用途 |
|------|-----------|------|
| Astro.js | 5.8.0 | 静的サイトジェネレーター |
| TypeScript | 5.x | 型安全な開発 |
| CSS | - | スタイリング |
| Node.js | 18.14.1+ | ランタイム環境 |

### 開発ツール

| ツール | 用途 |
|--------|------|
| Bun | パッケージ管理 |
| mise | バージョン管理 |
| lefthook | Git hooks |
| commitlint | コミットメッセージ検証 |
| Renovate | 依存関係の自動更新 |

## プロジェクト構造

```
ishinova.co.jp/
├── src/                    # ソースコード
│   ├── assets/            # コンポーネント用アセット
│   ├── components/        # Astroコンポーネント
│   │   └── Company/       # ネストされたコンポーネント
│   ├── layouts/           # レイアウトテンプレート
│   ├── pages/             # ページコンポーネント（ルーティング）
│   └── styles/            # グローバルスタイル
├── public/                # 静的アセット
│   ├── assets/           # 画像・SVGファイル
│   ├── icons/            # アプリアイコン
│   └── *.png, *.ico      # ファビコン、OGP画像
├── dist/                  # ビルド出力（gitignore）
├── docs/                  # プロジェクトドキュメント
└── tools/                 # ユーティリティスクリプト
```

### ディレクトリ詳細

#### `/src/components/`
再利用可能なUIコンポーネントを格納。各コンポーネントは単一責任の原則に従い設計。

```
components/
├── Header.astro       # ナビゲーションヘッダー
├── Hero.astro         # ランディングセクション
├── Concept.astro      # コンセプト説明
├── Features.astro     # 機能紹介
├── Vision.astro       # ビジョン説明
├── Contact.astro      # 連絡先情報
├── Footer.astro       # フッター
├── SEO.astro          # SEOメタタグ管理
└── Company/
    └── Company.astro  # 会社情報詳細
```

#### `/src/pages/`
ファイルベースルーティング。各ファイルが1つのルートに対応。

```
pages/
├── index.astro    # メインページ（/）
├── privacy.astro  # プライバシーポリシー（/privacy）
└── terms.astro    # 利用規約（/terms）
```

#### `/src/layouts/`
ページ全体の構造を定義するレイアウトコンポーネント。

```
layouts/
└── Layout.astro   # 基本レイアウト（HTML構造、メタタグ、共通要素）
```

## コンポーネントアーキテクチャ

### コンポーネント階層

```
Layout.astro (ルートレイアウト)
├── SEO.astro (メタタグ管理)
├── Header.astro (ナビゲーション)
├── <slot /> (ページコンテンツ)
│   ├── Hero.astro
│   ├── Concept.astro
│   ├── Features.astro
│   ├── Vision.astro
│   ├── Company.astro
│   └── Contact.astro
└── Footer.astro
```

### コンポーネント設計原則

1. **単一責任の原則**: 各コンポーネントは1つの明確な責務を持つ
2. **プロップスベース**: データはプロップスを通じて渡される
3. **スタイルのカプセル化**: コンポーネント固有のスタイルは内部で定義
4. **アクセシビリティ**: ARIA属性とセマンティックHTMLの使用

### コンポーネント例

```astro
---
// Hero.astro
export interface Props {
  title?: string;
  subtitle?: string;
}

const { title = "デフォルトタイトル", subtitle } = Astro.props;
---

<section class="hero">
  <h1>{title}</h1>
  {subtitle && <p>{subtitle}</p>}
</section>

<style>
  .hero {
    /* コンポーネント固有のスタイル */
  }
</style>
```

## データフロー

### 静的データの管理

1. **ハードコーディング**: 現在、すべてのコンテンツはコンポーネント内に直接記述
2. **プロップス**: 親コンポーネントから子コンポーネントへのデータ受け渡し
3. **グローバル設定**: `astro.config.mjs`でサイト全体の設定を管理

### SEOデータフロー

```
astro.config.mjs (サイト設定)
    ↓
Layout.astro
    ↓
SEO.astro (メタタグ生成)
    ↓
HTML <head> (出力)
```

### スタイルの適用順序

1. **リセットCSS**: ブラウザのデフォルトスタイルをリセット
2. **グローバルスタイル**: `/src/styles/global.css`
3. **コンポーネントスタイル**: 各`.astro`ファイル内の`<style>`タグ
4. **インラインスタイル**: 必要に応じて要素に直接適用

## ビルドプロセス

### 開発ビルド

```bash
bun run dev
```

1. Astro開発サーバーの起動
2. ファイル変更の監視
3. ホットモジュールリロード（HMR）
4. `http://localhost:4321`でプレビュー

### プロダクションビルド

```bash
bun run build
```

1. TypeScriptのコンパイル
2. Astroコンポーネントの静的HTML生成
3. CSSの最適化とバンドル
4. アセットの最適化
5. サイトマップの自動生成
6. `dist/`ディレクトリへの出力

### ビルド最適化

- **静的生成**: すべてのページが事前にHTMLとして生成
- **アセット最適化**: 画像の圧縮、未使用CSSの削除
- **コード分割**: 必要最小限のJavaScriptのみ配信

## 技術選定の理由

### Astro.jsを選択した理由

1. **パフォーマンス優先**
   - デフォルトでJavaScriptゼロ
   - 静的サイト生成による高速配信
   - 優れたCore Web Vitalsスコア

2. **開発体験**
   - コンポーネントベースの開発
   - TypeScriptのファーストクラスサポート
   - 豊富なインテグレーション

3. **SEO最適化**
   - サーバーサイドレンダリング
   - 自動サイトマップ生成
   - 構造化データの容易な実装

### TypeScriptの採用

1. **型安全性**: ランタイムエラーの削減
2. **開発効率**: IDEの強力な補完機能
3. **保守性**: コードの意図が明確
4. **リファクタリング**: 安全な変更が可能

### CSSアーキテクチャ

1. **スコープドスタイル**: コンポーネント内でスタイルを完結
2. **カスタムプロパティ**: テーマカラーの一元管理
3. **レスポンシブデザイン**: モバイルファーストアプローチ

### 依存関係管理

1. **Renovate**: 自動的な依存関係の更新
2. **Semantic Versioning**: 予測可能なアップデート
3. **最小限の依存**: コア機能に必要なもののみ

## セキュリティ考慮事項

1. **静的サイト**: サーバーサイドの脆弱性なし
2. **CSP対応**: Content Security Policyの実装
3. **HTTPS**: 常時SSL/TLS通信
4. **依存関係の監視**: Renovateによる脆弱性の早期発見

## 拡張性

### 将来的な拡張ポイント

1. **CMS統合**: ヘッドレスCMSとの連携
2. **多言語対応**: i18nの実装
3. **ダイナミックルート**: 動的なコンテンツ生成
4. **API統合**: 外部サービスとの連携

### スケーラビリティ

1. **CDN配信**: 静的アセットの効率的な配信
2. **エッジコンピューティング**: グローバルな低遅延配信
3. **増分静的再生成**: 部分的なサイト更新

---

最終更新日: 2025年5月28日